FROM node:16-alpine3.14

ARG SET_PORTOCOL
ARG SET_HOST
ARG SET_PORT
ARG SET_DB_HOST
ARG SET_DB_PORT
ARG SET_DB_NAME
ARG SET_DB_USER
ARG SET_DB_PASS
ARG SET_DB_AUTH
ARG SET_HANDLER_POOL_MAX
ARG SET_LOGGER_LEVEL
ARG SET_LOGGER_TRACE
ARG SET_LOGGER_LOGOUT
ARG SET_LOGGER_LOGERR

ENV NODE_ENV=production \
  RESTER_PROTOCOL=${SET_PORTOCOL} \
  RESTER_HOST=${SET_HOST} \
  RESTER_PORT=${SET_PORT} \
  RESTER_DB_HOST=${SET_DB_HOST} \
  RESTER_DB_PORT=${SET_DB_PORT} \
  RESTER_DB_NAME=${SET_DB_NAME} \
  RESTER_DB_USER=${SET_DB_USER} \
  RESTER_DB_PASS=${SET_DB_PASS} \
  RESTER_DB_AUTH=${SET_DB_AUTH} \
  RESTER_HANDLER_POOL_MAX=${SET_HANDLER_POOL_MAX} \
  RESTER_LOGGER_LEVEL=${SET_LOGGER_LEVEL} \
  RESTER_LOGGER_TRACE=${SET_LOGGER_TRACE} \
  RESTER_LOGGER_LOGOUT=${SET_LOGGER_LOGOUT} \
  RESTER_LOGGER_LOGERR=${SET_LOGGER_LOGERR}

RUN apk add --no-cache \
  udev \
  ttf-freefont \
  chromium

WORKDIR /app
COPY ["./dist/apps/surfboard-api", "/app"]

CMD ["node", "/app/main.js"]
